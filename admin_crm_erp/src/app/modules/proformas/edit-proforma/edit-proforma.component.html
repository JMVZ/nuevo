<div class="d-flex flex-column flex-column-fluid" data-select2-id="select2-data-131-dzps">
    <!--begin::Content-->
    <div id="kt_app_content" class="app-content  flex-column-fluid " data-select2-id="select2-data-kt_app_content">


        <!--begin::Content container-->
        <div id="kt_app_content_container" class="app-container  container-xxl "
            data-select2-id="select2-data-kt_app_content_container">
            <!--begin::Form-->
            <form id="kt_ecommerce_edit_order_form"
                class="form d-flex flex-column flex-lg-row fv-plugins-bootstrap5 fv-plugins-framework"
                data-kt-redirect="/metronic8/demo1/apps/ecommerce/sales/listing.html"
                data-select2-id="select2-data-kt_ecommerce_edit_order_form">
                <!--begin::Aside column-->
                <div class="w-100 flex-lg-row-auto w-lg-300px mb-7 me-7 me-lg-10"
                    data-select2-id="select2-data-130-y9wa">

                    <!--begin::Order details-->
                    <div class="card card-flush py-4" data-select2-id="select2-data-129-w2zd">
                        <!--begin::Card header-->
                        <div class="card-header">
                            <div class="card-title">
                                <h2>Proforma: #{{ PROFORMA_ID }}</h2>
                            </div>
                        </div>
                        <!--end::Card header-->

                        <!--begin::Card body-->
                        <div class="card-body pt-0" data-select2-id="select2-data-128-9mmu">
                            <div class="d-flex flex-column gap-10" data-select2-id="select2-data-127-2qsf">
                                <!--begin::Input group-->
                                <div class="fv-row">
                                    <!--begin::Label-->
                                    <label class="form-label">Fecha de Entrega</label>
                                    <!--end::Label-->

                                    <!--begin::Auto-generated ID-->
                                    <div class="fw-bold fs-3" *ngIf="PROFORMA_SELECTED">{{ PROFORMA_SELECTED.proforma_deliverie.date_entrega }}</div>
                                    <!--end::Input-->
                                </div>
                                <!--begin::Input group-->
                                <div class="fv-row">
                                    <!--begin::Label-->
                                    <label class="form-label">Fecha de Envio</label>
                                    <!--end::Label-->

                                    <!--begin::Auto-generated ID-->
                                    <div class="fw-bold fs-3" *ngIf="PROFORMA_SELECTED">{{ PROFORMA_SELECTED.proforma_deliverie.date_envio }}</div>
                                    <!--end::Input-->
                                </div>
                                <!--begin::Input group-->
                                <div class="fv-row">
                                    <!--begin::Label-->
                                    <label class="form-label">Sede de entrega</label>
                                    <!--end::Label-->

                                    <!--begin::Auto-generated ID-->
                                    <div class="fw-bold fs-3" *ngIf="PROFORMA_SELECTED">{{ PROFORMA_SELECTED.proforma_deliverie.sucursal_deliverie.name }}</div>
                                    <!--end::Input-->
                                </div>
                            </div>
                        </div>
                        <!--end::Card header-->
                    </div>
                    <!--end::Order details-->
                </div>
                <!--end::Aside column-->
                <span class="spinner-border spinner-border-sm align-middle ms-2" *ngIf="isLoading$ | async"></span>
                <!--begin::Main column-->
                <div class="d-flex flex-column flex-lg-row-fluid gap-7 gap-lg-10">
                    <!--begin::Order details-->
                    <div class="card card-flush py-4">
                        <!--begin::Card header-->
                        <div class="card-header" style="display: block;">
                            <!-- <div class="card-title"> -->
                                <div class="row justify-content-between">
                                    <div class="col-6 d-flex align-items-center">
                                        <h2 class="d-flex align-items-center"> <i class="ki-duotone ki-user fs-2tx"><span class="path1"></span><span class="path2"></span></i>  Cliente : 
                                        </h2>
                                        <small class="mx-2"> {{ CLIENT_SELECTED ? CLIENT_SELECTED.client_segment.name : 'NO HA SELECCIONADO UN CLIENTE' }}</small>
                                    </div>
                                    <div class="col-4">
                                        <button class="btn btn-sm mx-1 btn-primary" (click)="searchClients()" placement="top-start" ngbTooltip="Buscar">
                                            <i class="ki-duotone ki-magnifier fs-2"><span class="path1"></span><span class="path2"></span></i> 
                                        </button>
                                        <button class="btn btn-sm mx-1 btn-success" (click)="createClientPerson()" placement="top-start" ngbTooltip="Cliente Persona">
                                            <i class="ki-duotone ki-user fs-2"><span class="path1"></span><span class="path2"></span></i>
                                        </button>
                                        <button class="btn btn-sm mx-1 btn-info" (click)="createClientCompany()" placement="top-start" ngbTooltip="Cliente Empresa">
                                            <i class="ki-duotone ki-delivery-time fs-2"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span></i>
                                        </button>
                                        <button class="btn btn-sm mx-1 btn-dark" (click)="resetClient()" placement="top-start" ngbTooltip="Limpiar">
                                            <i class="ki-duotone ki-arrows-circle fs-2"><span class="path1"></span><span class="path2"></span></i>
                                        </button>
                                    </div>
                                </div>
                            <!-- </div> -->
                        </div>
                        <!--end::Card header-->

                        <!--begin::Card body-->
                        <div class="card-body pt-0">
                            <div class="row">
                                <div class="col-4">
                                    <input type="text" (keyup.enter)="searchClients()" [(ngModel)]="n_document" name="n_document" class="form-control mb-2" placeholder=" N° Documento" />
                                </div>
                                <div class="col-4">
                                    <input type="text" (keyup.enter)="searchClients()" [(ngModel)]="full_name" name="full_name" class="form-control mb-2" placeholder="Nombre completo" />
                                </div>
                                <div class="col-4">
                                    <input type="text" (keyup.enter)="searchClients()" [(ngModel)]="phone" name="phone" class="form-control mb-2" placeholder="Telefono" />
                                </div>
                            </div>
                        </div>
                        <!--end::Card header-->
                    </div>
                    <!--end::Order details-->
                    <!--begin::Subproyectos section-->
                    <app-subproyectos-proforma 
                        [proforma_id]="+PROFORMA_ID" 
                        [CLIENT_SELECTED]="CLIENT_SELECTED"
                        [sucursale_asesor]="sucursale_asesor"
                        [user]="user"
                        (subproyectosChanged)="onSubproyectosChanged($event)">
                    </app-subproyectos-proforma>
                    <!--end::Subproyectos section-->

                    <!--begin::Precio Global-->
                    <div class="card card-flush py-4">
                        <div class="card-header">
                            <div class="card-title">
                                <h2>Configuración de Precio</h2>
                            </div>
                        </div>
                        <div class="card-body pt-0">
                            <div class="form-check form-check-custom form-check-solid mb-3">
                                <input class="form-check-input" type="checkbox" id="precioGlobalSwitch" [(ngModel)]="usar_precio_global" name="usar_precio_global">
                                <label class="form-check-label" for="precioGlobalSwitch">Usar precio global</label>
                                    </div>
                            <div *ngIf="usar_precio_global" class="mb-3">
                                <label class="form-label">Precio Global</label>
                                <input type="number" class="form-control" [(ngModel)]="precio_global" name="precio_global" placeholder="Ingrese el precio global">
                            </div>
                            <div class="separator"></div>
                                    <div class="fw-bold fs-4">
                                        Total: 
                                        <span id="kt_ecommerce_edit_order_total_price">
                                    {{ usar_precio_global && precio_global > 0 ? precio_global : TOTAL_PROFORMA }}
                                        </span> MXN
                                        <br>
                                        Impuesto: {{ TOTAL_IMPUESTO_PROFORMA }} MXN
                                        <br>
                                Deuda: {{ (usar_precio_global && precio_global > 0 ? precio_global : DEBT_PROFORMA) - (amount_payment ? amount_payment : 0) }} MXN
                                        <br>
                                        Pagado: {{ PAID_OUT_PROFORMA + (amount_payment ? amount_payment : 0) }} MXN
                                </div>
                        </div>
                    </div>
                    <!--end::Precio Global-->
                    <!--begin::Order details-->
                    <div class="card card-flush py-4">
                        <!--begin::Card header-->
                        <div class="card-header" style="display: block;">
                            <!-- <div class="card-title"> -->
                                <div class="row justify-content-between">
                                    <div class="col-4">
                                        <h2 class="d-flex align-items-center"> <i class="ki-duotone ki-delivery-geolocation text-gray-900 fs-2tx"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span></i>
                                            Lugar de entrega : </h2>
                                    </div>
                                    <div class="col-3">
                                        <!-- <button class="btn btn-sm mx-1 btn-primary" placement="top-start" ngbTooltip="Buscar">
                                            <i class="ki-duotone ki-magnifier fs-2"><span class="path1"></span><span class="path2"></span></i> 
                                        </button> -->
                                        <button class="btn btn-sm mx-1 btn-dark" (click)="resetSucursaleDeliverie()" placement="top-start" ngbTooltip="Limpiar">
                                            <i class="ki-duotone ki-arrows-circle fs-2"><span class="path1"></span><span class="path2"></span></i>
                                        </button>
                                    </div>
                                </div>
                            <!-- </div> -->
                        </div>
                        <!--end::Card header-->

                        <!--begin::Card body-->
                        <div class="card-body pt-0">
                            <div class="row">
                                <div class="col-3">
                                    <select
                                        class="form-control form-select-solid fw-bolder"
                                        name="sucursale_deliverie_id"
                                        placeholder="Selec. Lugar de entrega"
                                        [(ngModel)]="sucursale_deliverie_id"
                                        (change)="changeSucursaleDeliverie()"
                                    >
                                        <option value="">Selec. Lugar de entrega</option>
                                        <ng-container *ngFor="let sucursale_deliv of sucursale_deliveries">
                                            <option [value]="sucursale_deliv.id">{{ sucursale_deliv.name }}</option>
                                        </ng-container>
                                        
                                    </select>
                                </div>
                                <div class="col-5">
                                    <textarea *ngIf="sucursale_deliverie_id == 5 || sucursale_deliverie_id == 6" class="form-control form-control-solid" rows="3" name="address" [(ngModel)]="address" placeholder="Dirección completa"></textarea>
                                </div>
                                <div class="col-4">
                                    <input type="date"
                                    class="form-control form-control-lg form-control-solid"
                                    [(ngModel)]="date_entrega"
                                    name="date_entrega"
                                    />
                                    <small>Fecha de entrega</small>
                                </div>
                                <div class="col-3" *ngIf="sucursale_deliverie_id == 6">
                                    <select
                                        class="form-control form-select-solid fw-bolder"
                                        name="ubigeo_region"
                                        [(ngModel)]="ubigeo_region"
                                        placeholder="Selec. Región"
                                        (change)="changeRegion($event)"
                                    >   
                                    <option value="">Selec. Región</option>
                                        <ng-container *ngFor="let REGION of REGIONES">
                                            <option [value]="REGION.id">{{ REGION.name }}</option>
                                        </ng-container>
                                    </select>
                                </div>
                                <div class="col-3" *ngIf="sucursale_deliverie_id == 6">
                                    <select
                                         class="form-control form-select-solid fw-bolder"
                                         name="ubigeo_provincia"
                                         [(ngModel)]="ubigeo_provincia"
                                         placeholder="Selec. Provincia"
                                         (change)="changeProvincia($event)"
                                     >
                                         <option value="">Selec. Provincia</option>
                                         <ng-container *ngFor="let PROVINCIA of PROVINCIA_SELECTEDS">
                                            <option [value]="PROVINCIA.id">{{ PROVINCIA.name }}</option>
                                         </ng-container>
                                         
                                     </select>
                                </div>
                                <div class="col-3" *ngIf="sucursale_deliverie_id == 6">
                                    <select
                                        class="form-control form-select-solid fw-bolder"
                                        name="ubigeo_distrito"
                                        [(ngModel)]="ubigeo_distrito"
                                        placeholder="Selec. Distrito"
                                    >
                                        <option value="">Selec. Distrito</option>
                                        
                                        <ng-container *ngFor="let DISTRITO of DISTRITO_SELECTEDS">
                                            <option [value]="DISTRITO.id">{{ DISTRITO.name }}</option>
                                         </ng-container>
                                    </select>
                                </div>
                                <div class="col-3" *ngIf="sucursale_deliverie_id != 5 && validationDeliverie()">
                                    <input type="text" [(ngModel)]="agencia" name="agencia" class="form-control mb-2" placeholder=" Agencia de Envio" />
                                </div>
                                <div class="col-3" *ngIf="sucursale_deliverie_id != 5 && validationDeliverie()">
                                    <input type="text" [(ngModel)]="full_name_encargado" name="full_name_encargado" class="form-control mb-2" placeholder="Nombre del encargado de recojo" />
                                </div>
                                <div class="col-3" *ngIf="sucursale_deliverie_id != 5 && validationDeliverie()">
                                    <input type="text" [(ngModel)]="documento_encargado" name="documento_encargado" class="form-control mb-2" placeholder="Documento del encargado de recojo" />
                                </div>
                                <div class="col-3" *ngIf="sucursale_deliverie_id != 5 && validationDeliverie()">
                                    <input type="text" [(ngModel)]="telefono_encargado" name="telefono_encargado" class="form-control mb-2" placeholder="Telefono del encargado de recojo" />
                                </div>
                            </div>
                        </div>
                        <!--end::Card body-->
                    </div>
                    <!--end::Order details-->
                    <div class="row justify-content-between">
                        <!--begin::Button-->
                        <div class="col-6">
                            <div class="card card-flush py-4 mb-5">
                                <div class="card-header">
                                    <div class="card-title">
                                        <h2>Detalles del Producto Final</h2>
                                    </div>
                                </div>
                                <div class="card-body pt-0">
                                    <div class="mb-5">
                                        <label class="form-label required">Título del Producto Final</label>
                                        <input type="text" class="form-control" [(ngModel)]="final_product_title" name="final_product_title" placeholder="Ingrese el título del producto final" />
                                        <div class="form-text">Ingrese un título descriptivo para el producto final.</div>
                                    </div>
                                    <div class="mb-5">
                                        <label class="form-label required">Descripción del Producto Final</label>
                                        <textarea class="form-control" rows="3" [(ngModel)]="final_product_description" name="final_product_description" placeholder="Ingrese la descripción del producto final"></textarea>
                                        <div class="form-text">Describa las características principales del producto final.</div>
                                    </div>
                                    <div class="mb-5">
                                        <label class="form-label required">Semanas de Desarrollo</label>
                                        <input type="number" class="form-control" [(ngModel)]="weeks" name="weeks" min="1" placeholder="Ingrese el número de semanas" />
                                        <div class="form-text">Tiempo estimado de desarrollo en semanas.</div>
                                    </div>
                                </div>
                            </div>
                            <textarea class="form-control form-control-solid mx-2" rows="3" [(ngModel)]="description" name="description" placeholder="Descripción general"></textarea>
                        </div>

                        <div class="col-3">
                            <button type="button" (click)="save()" class="btn btn-primary">
                                <span class="indicator-label">
                                    Editar Proforma
                                </span>
                                <!-- <span class="indicator-progress">
                                    Please wait... <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                                </span> -->
                            </button>
                        </div>
                        <!--end::Button-->
                    </div>
                </div>
                <!--end::Main column-->
            </form>
            <!--end::Form-->
        </div>
        <!--end::Content container-->
    </div>
    <!--end::Content-->

</div>